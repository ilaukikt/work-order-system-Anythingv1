import{C as r}from"./PolymorphicComponent-BX0mGPA7.js";import{r as x,o as e,p as L}from"./chunk-OIYGIGL5-Bl7fu__Q.js";import{R as P}from"./layout-DujwgiLM.js";import{c as _,u as z,L as D}from"./loader-circle-MXmvxXnL.js";import{A as U}from"./arrow-left-CZCw9Flu.js";import{B as $,C as y}from"./chevron-down-DWLuOVI3.js";import{S as F}from"./search-B4Ptt0Lv.js";import{F as R}from"./filter-BSQRzRej.js";import{C as M}from"./circle-alert-DZMD2-Db.js";import{A as j}from"./activity-BvVUradw.js";import{U as O}from"./user-G-DUsIBb.js";import{E as B}from"./eye-DIw6tOc0.js";import{T as q,S as H}from"./trash-2-B5TRt7gO.js";import{P as W}from"./plus-C2kr1Kd7.js";if(typeof window<"u"){const t={};globalThis.process??={};const d=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},t,d),{get(a,i){return i in a?a[i]:void 0},has(){return!0}})}const G=_("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);if(typeof window<"u"){const t={};globalThis.process??={};const d=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},t,d),{get(a,i){return i in a?a[i]:void 0},has(){return!0}})}function V(){const[t,d]=x.useState(""),[a,i]=x.useState(""),[m,v]=x.useState(""),[o,u]=x.useState(1),[p,I]=x.useState(!1),{data:h,isLoading:N,error:b,refetch:w}=z({queryKey:["activity-logs",o,a,m],queryFn:async()=>{const s=new URLSearchParams({page:o.toString(),limit:"20"});a&&s.append("entity_type",a),m&&s.append("activity_type",m);const n=await fetch(`/api/activity-logs?${s}`);if(!n.ok)throw new Error("Failed to fetch activity logs");return n.json()}}),C=h?.activityLogs||[],l=h?.pagination||{},f=C.filter(s=>{if(!t)return!0;const n=t.toLowerCase();return s.description.toLowerCase().includes(n)||s.user_name.toLowerCase().includes(n)||s.entity_type.toLowerCase().includes(n)||s.activity_type.toLowerCase().includes(n)}),T=s=>{const n=new Date(s),c=Math.floor((new Date-n)/(1e3*60));return c<1?"Just now":c<60?`${c}m ago`:c<1440?`${Math.floor(c/60)}h ago`:c<10080?`${Math.floor(c/1440)}d ago`:n.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},A=s=>{switch(s){case"CREATE":return e.jsx(W,{size:16,className:"text-green-600"});case"UPDATE":return e.jsx(H,{size:16,className:"text-blue-600"});case"DELETE":return e.jsx(q,{size:16,className:"text-red-600"});case"STATUS_CHANGE":return e.jsx(G,{size:16,className:"text-purple-600"});default:return e.jsx(j,{size:16,className:"text-gray-600"})}},E=s=>{const g={CREATE:{bg:"bg-green-100",text:"text-green-800",label:"Created"},UPDATE:{bg:"bg-blue-100",text:"text-blue-800",label:"Updated"},DELETE:{bg:"bg-red-100",text:"text-red-800",label:"Deleted"},STATUS_CHANGE:{bg:"bg-purple-100",text:"text-purple-800",label:"Status Changed"}}[s]||{bg:"bg-gray-100",text:"text-gray-800",label:s};return e.jsx(r,{className:`px-2 py-1 rounded-full text-xs font-medium ${g.bg} ${g.text}`,renderId:"render-47275560",as:"span",children:g.label})},k=s=>e.jsx(r,{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",renderId:"render-02da512b",as:"span",children:s.replace("_"," ").toUpperCase()}),S=s=>{window.location.href=`/work-orders/${s}`};return e.jsxs(r,{className:"min-h-screen bg-gray-50",renderId:"render-b0e82d65",as:"div",children:[e.jsxs(r,{className:"bg-green-600 h-14 flex items-center px-4 sm:px-6 text-white sticky top-0 z-30",renderId:"render-f941e48b",as:"header",children:[e.jsxs(r,{onClick:()=>window.history.back(),className:"flex items-center gap-2 hover:bg-white/10 px-2 py-1 rounded transition-colors",renderId:"render-09b98eeb",as:"button",children:[e.jsx(U,{size:20}),e.jsx(r,{className:"hidden sm:block",renderId:"render-b429c159",as:"span",children:"Back"})]}),e.jsx(r,{className:"text-xl font-semibold ml-4",renderId:"render-30964dbe",as:"h1",children:"Activity Log"}),e.jsxs(r,{className:"flex items-center gap-2 sm:gap-4 ml-auto",renderId:"render-deba291c",as:"div",children:[e.jsxs(r,{className:"relative hover:bg-white/10 p-2 rounded transition-colors",renderId:"render-ceec2363",as:"button",children:[e.jsx($,{size:24}),e.jsx(r,{className:"absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full",renderId:"render-23f7576d",as:"div"})]}),e.jsxs(r,{className:"hidden sm:flex items-center gap-2 cursor-pointer hover:bg-white/10 px-3 py-2 rounded transition-colors",renderId:"render-20542788",as:"button",children:[e.jsx(r,{src:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop&crop=face&auto=format",alt:"User Avatar",className:"w-8 h-8 rounded-full",renderId:"render-a2465a8e",as:"img"}),e.jsx(r,{className:"hidden md:block",renderId:"render-e2d686ee",as:"span",children:"Admin User"}),e.jsx(y,{size:20})]})]})]}),e.jsxs(r,{className:"max-w-7xl mx-auto p-6",renderId:"render-c5f7c1b6",as:"main",children:[e.jsxs(r,{className:"mb-6",renderId:"render-2aaee86b",as:"div",children:[e.jsx(r,{className:"text-3xl font-bold text-gray-900 mb-2",renderId:"render-61709213",as:"h1",children:"Activity Log"}),e.jsx(r,{className:"text-gray-600",renderId:"render-4c1b3537",as:"p",children:"Track all activities and changes in your work order management system."})]}),e.jsxs(r,{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",renderId:"render-068d00c6",as:"div",children:[e.jsxs(r,{className:"flex flex-col lg:flex-row gap-4",renderId:"render-ee3d4f0b",as:"div",children:[e.jsx(r,{className:"flex-1",renderId:"render-0aba2308",as:"div",children:e.jsxs(r,{className:"relative",renderId:"render-3c6c896b",as:"div",children:[e.jsx(F,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(r,{type:"text",placeholder:"Search activities, users, or descriptions...",value:t,onChange:s=>d(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",renderId:"render-fcb7b5ec",as:"input"})]})}),e.jsxs(r,{onClick:()=>I(!p),className:"flex items-center gap-2 px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",renderId:"render-ee0409ce",as:"button",children:[e.jsx(R,{size:20}),e.jsx(r,{renderId:"render-0a68136a",as:"span",children:"Filters"}),e.jsx(y,{size:16,className:`transform transition-transform ${p?"rotate-180":""}`})]})]}),p&&e.jsxs(r,{className:"grid md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-200",renderId:"render-c83a6e58",as:"div",children:[e.jsxs(r,{renderId:"render-12dea462",as:"div",children:[e.jsx(r,{className:"block text-sm font-medium text-gray-700 mb-2",renderId:"render-e6432b7b",as:"label",children:"Entity Type"}),e.jsxs(r,{value:a,onChange:s=>i(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",renderId:"render-b1384763",as:"select",children:[e.jsx(r,{value:"",renderId:"render-79cf56b7",as:"option",children:"All Entities"}),e.jsx(r,{value:"work_order",renderId:"render-721e136d",as:"option",children:"Work Orders"}),e.jsx(r,{value:"company",renderId:"render-091b0d8d",as:"option",children:"Companies"})]})]}),e.jsxs(r,{renderId:"render-92a1b9a9",as:"div",children:[e.jsx(r,{className:"block text-sm font-medium text-gray-700 mb-2",renderId:"render-2a31a545",as:"label",children:"Activity Type"}),e.jsxs(r,{value:m,onChange:s=>v(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",renderId:"render-524a55a9",as:"select",children:[e.jsx(r,{value:"",renderId:"render-ec754993",as:"option",children:"All Activities"}),e.jsx(r,{value:"CREATE",renderId:"render-59984f35",as:"option",children:"Created"}),e.jsx(r,{value:"UPDATE",renderId:"render-2c94ab2e",as:"option",children:"Updated"}),e.jsx(r,{value:"DELETE",renderId:"render-345145bd",as:"option",children:"Deleted"}),e.jsx(r,{value:"STATUS_CHANGE",renderId:"render-a06ac006",as:"option",children:"Status Changes"})]})]})]})]}),e.jsx(r,{className:"bg-white rounded-lg border border-gray-200",renderId:"render-5ad85e23",as:"div",children:N?e.jsx(r,{className:"flex items-center justify-center py-12",renderId:"render-8bcf8b40",as:"div",children:e.jsx(D,{size:32,className:"text-green-600 animate-spin"})}):b?e.jsxs(r,{className:"text-center py-12",renderId:"render-dab5c320",as:"div",children:[e.jsx(M,{size:32,className:"text-red-500 mx-auto mb-2"}),e.jsx(r,{className:"text-gray-600",renderId:"render-7bfd3537",as:"p",children:b?.message||"Failed to load activity logs"}),e.jsx(r,{onClick:()=>w(),className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",renderId:"render-3f4ed2c0",as:"button",children:"Try Again"})]}):f.length===0?e.jsxs(r,{className:"text-center py-12",renderId:"render-20e298f5",as:"div",children:[e.jsx(j,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx(r,{className:"text-gray-600",renderId:"render-3a03bd71",as:"p",children:"No activity logs found"}),t&&e.jsx(r,{onClick:()=>d(""),className:"mt-2 text-green-600 hover:underline",renderId:"render-3e2e0861",as:"button",children:"Clear search"})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"divide-y divide-gray-200",renderId:"render-c50924a6",as:"div",children:f.map(s=>e.jsx(r,{className:"p-6 hover:bg-gray-50",renderId:"render-7d2455c8",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-c9899b5f",as:"div",children:[e.jsx(r,{className:"flex-shrink-0 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",renderId:"render-77f0f3b1",as:"div",children:A(s.activity_type)}),e.jsxs(r,{className:"flex-1 min-w-0",renderId:"render-0e0a093d",as:"div",children:[e.jsxs(r,{className:"flex items-center gap-3 mb-2",renderId:"render-08b98f1e",as:"div",children:[E(s.activity_type),k(s.entity_type),e.jsx(r,{className:"text-sm text-gray-500",renderId:"render-c20ce7f2",as:"span",children:T(s.created_at)})]}),e.jsx(r,{className:"text-gray-900 font-medium mb-1",renderId:"render-c1a55256",as:"p",children:s.description}),e.jsxs(r,{className:"flex items-center gap-4 text-sm text-gray-600",renderId:"render-43d0d009",as:"div",children:[e.jsxs(r,{className:"flex items-center gap-1",renderId:"render-c43c5f21",as:"div",children:[e.jsx(O,{size:14}),e.jsx(r,{renderId:"render-39ce5794",as:"span",children:s.user_name})]}),s.entity_type==="work_order"&&e.jsxs(r,{onClick:()=>S(s.entity_id),className:"flex items-center gap-1 text-green-600 hover:underline",renderId:"render-e33bf21f",as:"button",children:[e.jsx(B,{size:14}),e.jsx(r,{renderId:"render-9a14a1cd",as:"span",children:"View Work Order"})]})]}),s.details&&Object.keys(s.details).length>0&&e.jsxs(r,{className:"mt-3",renderId:"render-b0fe17d5",as:"details",children:[e.jsx(r,{className:"cursor-pointer text-sm text-gray-600 hover:text-gray-800",renderId:"render-9b1b25a3",as:"summary",children:"View Details"}),e.jsx(r,{className:"mt-2 p-3 bg-gray-50 rounded-lg",renderId:"render-6aacf63a",as:"div",children:e.jsx(r,{className:"text-xs text-gray-700 whitespace-pre-wrap overflow-x-auto",renderId:"render-16b1715c",as:"pre",children:JSON.stringify(s.details,null,2)})})]})]})]})},s.id))}),l.totalPages>1&&e.jsx(r,{className:"p-6 border-t border-gray-200",renderId:"render-e544a834",as:"div",children:e.jsxs(r,{className:"flex items-center justify-between",renderId:"render-ab1cff5b",as:"div",children:[e.jsxs(r,{className:"text-sm text-gray-600",renderId:"render-f4a0edbd",as:"div",children:["Showing page ",l.page," of ",l.totalPages," ","(",l.total," total activities)"]}),e.jsxs(r,{className:"flex gap-2",renderId:"render-12fac954",as:"div",children:[e.jsx(r,{onClick:()=>u(o-1),disabled:o<=1,className:"px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",renderId:"render-86ea3805",as:"button",children:"Previous"}),e.jsx(r,{onClick:()=>u(o+1),disabled:o>=l.totalPages,className:"px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",renderId:"render-f9214a27",as:"button",children:"Next"})]})]})})]})})]})]})}if(typeof window<"u"){const t={};globalThis.process??={};const d=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},t,d),{get(a,i){return i in a?a[i]:void 0},has(){return!0}})}const ce=L(function(d){return e.jsx(P,{children:e.jsx(V,{...d})})});export{ce as default};
